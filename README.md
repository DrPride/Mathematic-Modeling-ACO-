## 给刚刚过去的五一建模比赛留点东西，做个记录。
## 前两题的代码应该是没什么问题的，后两题等以后有能力再改吧。
## 这次数模真的是展现了自己编程能力的低下，引以为戒。


```
五 一 数 学 建 模 竞 赛
 

       题 目：    徐州潘安湖风景区游览路线设计              
关键词：游览路线 图论 Dijkstra算法 蚁群算法 DFS 多线程互斥 正态分布 TSP
摘  要：
随着徐州潘安湖湿地公园从徐州最大的、塌陷最严重的采煤塌陷区转型为国家级水利风景区后，徐州旅游综合收入节节高升，本题选取潘安湖景区的部分景点提出关于徐州潘安湖风景区游览路线的问题。本文基于蚁群算法得出距离最短的路线，再以生成符合正态分布的随机数与多线程互斥的方法得出游览总时间最长的路线，算法的可行度与可操作性高，在现实生活中具有重要的实际指导意义。
针对问题一，需要解决游览所有景点至少1次的距离最短的路线问题，利用蚁群算法模拟真实蚂蚁寻路的过程，通过信息素的更新来使路径的选取更加符合题意，由于题目描述为每个景点经过至少一次，在代码中体现为蚂蚁小概率会选择已去的景点，接着很容易由编程得出最短路径，并按照表3的格式填写。
针对问题二，在问题一的基础上，规定游览起止时间，解决游览总时间最长的游览路线问题，假设所有时间仅仅分配为走路时间和游玩时间，其本质和第一题一样，仍旧是哈密顿最短路径问题，引入时间的正态分布随机生成机制以及约束条件，通过扩大蚁群规模和增加迭代数目，易求得结果，并按照表4的格式填写。
针对问题三，在问题二的基础上，增加为三个旅游团，一个多团体争夺资源的问题，我们将其简化为多线程互斥问题。通过定义互斥量数组，在蚂蚁对象选择下个节点时对互斥量进行访问，从而确认是否能选择该节点。
针对问题四，在问题三的基础上，限制了步行速度的要求，我们假设这些团体的行进速度分布曲线满足正态分布，设计相应算法生成随机速度，其数学期望为上下限的平均值，使其整体速度的平均值不超过上下限的平均值。
针对问题五，在问题四的基础上，增加了两个不确定因素，对于情况二，只需要随机增加出发时间的随机生成值,然后实现方法同问题四。而对于情况二，则其情况更为复杂，设计扰动函数，即在一定条件下打乱序列，具体情况比如
1、每次寻路上小概率加上意外时间(时长随机生成且超过极限值时打乱序列)。
2、对散客的来访假设其来访满足正态分布，则随机在高峰段打乱序列。
 

	问题重述
1.1问题背景

2017年12月12日至13日，习近平总书记在徐州调研贾汪区潘安采煤塌陷区整治工程时强调，塌陷区要坚持走符合国情的转型发展之路，打造绿水青山，并把绿水青山变成金山银山。位于徐州市贾汪区西南部、紧邻马庄的潘安湖湿地公园原来就是徐州最大的、塌陷最严重的采煤塌陷区。2010年，江苏省单体投资最大的一宗土地整理项目在潘安湖启动，2016年，贾汪被列为“国家全域旅游示范区”首批创建单位，全区旅游综合收入节节高升。本题选取潘安湖景区的部分景点，要求完成徐州潘安湖风景区游览路线设计问题。

1.2问题概述

相关的规定与假设为：
（1）任意两个景点之间的最短步行距离如表1给出。
（2）第二问、第三问假设步行速度 。
（3）游客在景区停留的时间由“景点之间的步行时间”、“景点游览时间（即在景点内游玩的时间）” 和“在景区外的等待时间”三部分组成，其他时间忽略不计，游览时间必须符合表2的要求。
问题一：从景石出发，步行游览①-⑦景点，建立数学模型，找出从景石出发，到达⑦湿地商业街，并且经过①—⑥所有景点至少1次的距离最短的路线，计算该路线的长度，并将相关结果填入表格3。（注：在每个景点不用停留。）
问题二：如果某游客12:00从景石出发，要求他17:00前到达湿地商业街，17:30离开湿地商业街(注：根据表2的要求在湿地商业街游览时间至少为30分钟)。建立数学模型，为该游客设计一条能游览完全部景点(景点①—⑦)且游览总时间最长的游览路线（假设在各个景点没有等待时间），并完成表4的填写。
问题三：如果有3个旅游团，与问题二的条件相同，并且每个景点（湿地商业街除外）同时只能容纳1个旅游团游览，按照时间顺序后到达的旅游团，需要等待先到达的旅游团游览结束之后才能开始游览。建立数学模型，为三个旅游团分别设计一条能游览完全部7个景点且游览总时间最长的游览路线，并完成表5的填写。
问题四：假设3个旅游团的步行速度可以在1km/h到3km/h之间调节，但是总的平均步行速度不能超过2km/h，其他条件与问题三相同，建立数学模型，为三个旅游团分别设计一条能游览完全部7个景点且游览总时间长，总的等待时间短的游览路线，并完成表6的填写。
问题五：在现实中，考虑如下两个不确定性因素：
(1)不同旅游团从景石出发的时间具有不确定性，例如，多个旅游团在不同的时间从景石出发开始游览，在此情况下到达湿地商业街的时间可以顺延。
(2)每个景点的等待时间也存在不确定性因素，例如，旅游设施短时间的维护和清理，或者受到散客客流的影响。
考虑上述两个不确定性因素，其它条件与问题4相同，建立数学模型，为多个旅游团分别设计一条能游览完全部7个景点且游览总时间长，总的等待时间短的游览路线。
	问题分析
本题研究的是旅游路线问题，问题一至五为四种递进情况下合理规划路线的问题，本文的解题思路也是沿着这样的思想一步一步展开的，即通过简单到复杂的情况逐步展开讨论。

2.1问题一的分析

针对问题一，我们发现除了个别特殊情况，这个问题即寻找最短路径的哈密顿通路。根据题意，通过蚁群算法模型模拟游客寻路的过程，我们通过在大量迭代过程中，“信息素”这一变量的更新来完成对函数的收敛，(蚁群算法的移动规则：蚂蚁朝信息素最多的方向移动，当周围没有信息素指引时，会按照原来运动方向惯性移动。而且会记住最近走过的点，防止原地转圈。)而这一更新过程使得信息素与(DBQ(我们设定的信息素总量)/总路程)正相关，使算法函数向总路程最短的方向收敛。且根据“每个节点至少到达一次”的表述，我们将选择去过的节点的概率设定为0.01，即存在但极小。

2.2问题二的分析

针对问题二，在问题一的基础上设计惩罚函数，引入随机生成时长满足正态分布的时间量，实现对路径的约束。根据题意我们发现只有两个节点存在时间约束，且其他节点都有足够的调整空间，即其题目的本质和第一题相似，仍是一个寻找最短路径的哈密顿通路的TSP问题。

2.3问题三的分析

针对问题三，我们发现这是一个多团体争夺资源的问题，我们将其简化为多线程互斥问题。通过定义互斥量数组，在蚂蚁寻路，选择下个节点时对互斥量进行访问，根据返回结果确认是否能选择该节点。当不能选择时，做二元判断，即选择等待或选择跳过。这个判断我们通过0-1概率生成选择。通过线程通讯获得其线程中对象的逃出时间并写入其进入时间。运行程序循环打印出路径列表即可。

2.4问题四的分析

针对问题四，根据题意则是在上一问的基础上，团体的速度出现波动，根据假设，这些团体的行进速度分布曲线满足正态分布，设计相应算法生成随机速度，取合理方差，且其数学期望为上下限的平均值，使其整体速度的平均值不超过上下限的平均值，即设计生成速度的随机函数。将之前两个问题中使用打表列出的移动时间用路程/随机速度取代，运行程序循环打印出路径列表即可。

2.5问题五的分析

针对问题五，由题意可知其随机性更大。针对情况一来说，只需要随机增加出发时间的随机生成值,(查阅资料可得，故宫作为中国游客流量最大的景点，其极限日流量为六万，按十人组团来算，其旅游团数不超过6000，数量级不大，其出发时间接近平均分布)然后实现方法同问题四。而针对情况二，则其情况更为复杂，设计扰动函数，具体情况比如①每次寻路上小概率加上意外时间(时长随机生成且超过极限值时进入扰动函数)。②对散客的来访假设其来访满足正态分布，则随机在高峰段进入扰动函数。最后运行程序循环打印出路径列表即可。



	模型假设
	假设游客游览途中不因为任何事情的干扰而终止游览。
	假设前四题的景点都不存在游客过多禁止游览，设备维护等问题。
	假设前四题游客不因为特殊情况中途休息。
	假设前三题步行速度是匀速的。


	符号说明
符号	意义
C	景点的数量
D	两两景点间的距离
L	最短路径
X_D	景点之间最短步行距离矩阵
S	游客出发的景点
E	游客终止的景点
X_T	景点之间最短步行距离所花的时间矩阵
T_in	游客进入景点的时间
T_cost	游客在景点花费的时间
P_wait	游客选择等待的几率
V_move	游客移动的速度
Textra	游客在游览过程中由于意外而耽误的时间
P_visit	散客来访的概率
N	概率密度函数
μ	位置参数，尺度参数
P_change	调用扰动函数的概率


	模型的建立与求解
5.1问题一模型的建立与求解

5.1.1建模过程

我们首先由Dijkstra算法已经知道了景点之间最短步行距离矩阵X_D，再通过蚁群算法模型模拟游客寻路的过程，并通过大量迭代与更新，搜索过程使用分布式计算方式，使算法函数向总路程最短的方向收敛，最后算法将得到经过①—⑥所有景点至少1次的距离最短的路线与路程。（表格见附录）
 
图1 蚁群算法的收敛过程

蚁群算法解决TSP问题的基本步骤包括初始化相关参数（比如蚁群规模，信息素重要程度因子，启发程度重要程度因子，信息素会发因子，信息素释放总量，最大迭代次数，迭代次数初值），构建解空间，更新信息素，判断是否终止。[1]

 
图2 蚁群算法图解

蚁群算法的2个核心步骤是路径构建和信息素更新。[2]
 
图3 现实中的蚁群

①随机概率是按照下列公式进行随机计算的：
 

其中：
i,j分别为起点和终点
nij =1/dij为能见度，是两点i,j路距离的倒数
τ_ij (t)为时间t时由i到j的信息素强度
allowedk为尚未访问过的节点集合
α，β为两常数，分别是信息素和和能见度的加权值
②信息素更新：
初始化信息浓度  τ_ij=C   ∀i,j
每一轮过后，问题空间中的所有路径上的信息素都会发生蒸发,然后，所有的蚂蚁根据自己构建的路径长度在它们本轮经过的边上释放信息素，公式如下：
 

其中：
∆〖t_ij〗^k表示蚂蚁k在景点i与景点j的连接路径上，释放的信息素浓度。
∆t_ij表示所有蚂蚁在景点i与景点j的连接路径上，释放的信息素浓度。
 

5.1.2数学模型

目标函数：
s.t.f(X_D )=∑_(l=1)^n▒d_(i_(l-1) i_l ) 


约束条件：            
∑_(j=1)^n▒〖x_ij=1,i=1,2,…,n〗
∑_(i-1)^n▒〖x_ij=1,j=1,2,…,n〗


5.1.3模型求解

step1：建立蚂蚁对象，初始化包括节点数目、蚁群规模、迭代次数、信息素残留因子、启发因子(信息素的重要程度)、期望因子(节点间距离的重要程度)等参数。
step2：迭代开始，在迭代过程中，由于信息素的更新其结果会收敛。
step3：循环打印迭代列表，最终打印最短路径序列和最短路径长度。


5.2问题二模型的建立与求解

5.2.1建模过程

本题约束了游客游览总时间最长的条件，因此是在问题一的基础上设计惩罚函数，约束的实现是通过引入随机生成时长满足正态分布的时间量。
正态分布（英语：normal distribution）又名高斯分布（英语：Gaussian distribution），是一个非常常见的连续概率分布。正态分布在统计学上十分重要，经常用在自然和社会科学来代表一个不明的随机变量。
正态分布的数学期望值或期望值μ等于位置参数，决定了分布的位置；其方差 σ^2的开平方或标准差σ 等于尺度参数，决定了分布的幅度。
正态分布的概率密度函数曲线呈钟形，因此人们又经常称之为钟形曲线（类似于寺庙里的大钟，因此得名）。我们通常所说的标准正态分布是位置参数μ=0，尺度参数 σ^2 = 1的正态分布（见图中红色曲线）
 
图4 正态分布（高斯分布）曲线

同时我们可知有两个节点存在时间约束，其它节点都有足够的调整时间，我们通过约束条件由算法实现了建模过程（结果见附录）。

5.2.2数学模型

如下是我们使用生成随机数的方法：
高斯分布随机数产生方法——Box-Muller算法
 
Y=u+(Z×sigma)
u，sigma分别为期望和方差

目标函数:                  
f(X_D )=∑_(l=1)^n▒d_(i_(l-1) i_l ) 
约束条件:
5.2.3模型求解

step1：建立蚂蚁对象，初始化参数。
step2：引入互斥量数组和线程通信模块。
step3：引入等待函数(包括对是否选择等待的判断以及选择等待时获取占用互斥量线程的离开时间)。
step4：迭代开始，结果收敛。
step5：打印最优解路径序列、路径长度和参考时间长度5.3问题三模型的建立与求解。

5．3问题四模型的建立与求解

5.3.1建模过程

我们在第二问的模型基础上引入多线程模型，通过创建互斥量数组来保证每个景点都只能被一个线程(即一个团体)占用。
 
图5 单个线程的状态转换
由于遇到已被占用的互斥量，游客存在一定几率进行等待，这个几率让其随机产生，且在等待函数中要有对占用互斥量的他线程进行访问，即线程通信。
这一过程是对团体不能进入被别团体占据的景点的仿真，理论上只要蚁群规模
足够大且迭代次数够多，则必然能算出最优解。

 
图6 多线程互斥图解

5.3.2数学模型

目标函数：
f(X_D )=∑_(l=1)^n▒T_costi 
约束条件：
P_wait⊆(0,1)

5.3.3模型求解

step1：建立蚂蚁对象，初始化参数。
step2：引入互斥量数组和线程通信模块。
step3：引入等待函数(包括对是否选择等待的判断以及选择等待时获取占用互斥量线程的离开时间)。
step4：迭代开始，结果收敛。
step5：打印最优解路径序列、路径长度和参考时间长度。

5.4问题四模型的建立与求解

5.4.1建模过程

在问题三的基础上，本题使旅游团的步行速度可以在1km/h到3km/h之间，因此速度是不确定性的，但是总的平均速度不能超过2km/h, 因此是在问题三之上增加一个随机速度的约束条件，这些团体的行进速度分布曲线满足正态分布，设计相应算法生成随机速度，取合理方差，且其数学期望为上下限的平均值，使其整体速度的平均值不超过上下限的平均值，即设计生成速度的随机函数。将之前两个问题中使用打表列出的移动时间用路程/随机速度取代，运行程序即可得到结果（结果见附录）。

5.4.2数学模型

目标函数：
f(X_D )=∑_(l=1)^n▒T_costi 
约束条件：
V_move∼N(μ,δ^2)

5.4.3模型求解

step1：建立蚂蚁对象，初始化参数。
step2：引入行进速度生成函数。
step3：创建多线程，迭代开始，结果收敛。
step5：打印最优解路径序列、路径长度和参考时间长度

5.5问题五模型的建立与求解

5.5.1建模过程

我们在上一问的模型基础上加入扰动因素，对题设条件进一步仿真。

5.5.2数学模型

目标函数：
f(X_D )=∑_(l=1)^n▒T_costi 
约束条件：
Textra≤Textramax
C_visit~N(μ,δ^2)
C_change=C_visit

5.5.3模型求解

step1：建立蚂蚁对象，初始化参数。
step2：引入随机增加出发函数和扰动函数。
step3：创建多线程，迭代开始，扰动函数被随机调用，结果收敛。
step5：打印最优解路径序列、路径长度和参考时间长度。
	误差分析
6.1 问题一

6.1.1 误差分析

由于是现代优化算法，蚁群算法给出的最优解是概率性的，可能会由于收敛函数设计的不到位而产生误差

6.1.2 结果分析

我们将迭代结果加上约束打印出来，从而验证其结果的收敛。

6.1.3 模型检验

由于题目中的节点数量为个位数，其全排列解空间也并非不能使用暴力算法的出结果。根据DFS算法得出的序列和总路程和根据蚁群算法得出的结果完全吻合，说明本模型正确合理，是可行的。


6.2 问题二、问题三和问题四

6.2.1 误差分析

1.每增加一个随机函数，意味着我们需要更大的蚂蚁群体和迭代数才能确保函数的收敛是有效的。否则就会产生误差。
2.我们没有讨论其时间约束是应该设定成整型还是浮点数，这意味着我们对到达时间是否有近似行为，考虑到现实生活我们认为02:30:01和02:30:59同属一分钟，所以我们对结果近似化。在这一过程中可能发生了误差。
3.对于问题三和问题四，多线程的引入会使程序运行的开销大大增加，可能会出现硬件上的异常，产生误差。

6.2.2 结果分析

通过打印中间结果可以判断函数的收敛性。且问题三的结论是问题四结论的极限（理论最优解）

6.2.3 模型检验

随机生成序列计算出冲突次数和路径总长，和模型返回结果进行比对，由此说明模型的有效性。



6.3 问题五

6.3.1 误差分析

1．扰动函数让程序运行结果的随机程度再次增强，对于扰动函数的设计可能和现实有较大的差距。
2．多线程与随机程度的再次增强，会使得程序运行的开销指数级增加，出现异常的几率更高，被抛出的数据无法为函数收敛起到帮助，即提高了函数收敛的难度。也意味着最后的结果可能是局部最优解而不是全局最优解。

6.3.2 结果分析

蚁群规模的增大和迭代次数的增加理论上抵消了随机程度增大对函数收敛的影响，打印中间结果显示函数收敛。

6.3.3 模型检验

将随机生成的各种扰动因素和真实情况进行比对，来验证模型的可靠性。

	模型评价与改进
7.1 问题一、二模型的评价

7.1.1 模型的优点

1.Dijkstra经典算法是一种遍历算法，每次能保证100%搜索到最短路径。
2.针对DFS，作为传统优化算法能在小范围内保证结果的准确性，适用于对模型的检验。
3.对于蚁群算法，实现了随机算法与局部搜索算法相结合，是启发式算法的改进，可以用来解决一些尚未找到有效算法的问题。蚁群算法可在后期快速收敛。
4.在问题二中，引入截断正态分布随机数，使算法更具有统计意义。

7.1.2 模型的缺点

1.原始Dijkstra算法在存储图形数据和运算时，基于网络的权矩阵，需要根据其节点与距离之间的关系，形成关联矩阵、邻接矩阵与距离矩阵，需要定义N×N的二维数组来存储数据，其中N为网络的节点数，当网络的节点数较大时，将占用大量的计算机内存。它的搜索效率非常低，时间开销较大。
2.蚁群算法在程序中随机数过多时，容易增大解空间的范围，从而使得收敛的速度大大降低，也使得结果可能出现更多的误差。

7.1.3 模型的改进

1.在原始Dijkstra算法的基础上，减小算法中成功搜索的搜索范围以尽快到达目标节点，并优化其存储结构。
2.对参数进行系统化调优，使其效率更高。

7.2 问题三、四模型的评价

7.2.1 模型的优点

1.蚁群算法，实现了随机算法与局部搜索算法相结合，是启发式算法的改进，可以用来解决一些尚未找到有效算法的问题，节省时空效率。
2.蚁群算法采用正反馈机制，使得搜索过程不断收敛，最终逼近最优解。
3.蚁群算法是一种基于种群的进化算法，具有本质并行性，易于实现并行。
4.搜索过程采用分布式计算方式，多个个体同时进行并行计算，大大提高了算法的计算能力和运行效率。
4.多线程实现互斥模拟，对题设进行仿真。

7.2.2 模型的缺点

1.如果α和β设置不当，导致求解速度很慢且所得解质量较差。
2.基本蚁群算法计算量大，求解所需时间较长。
3.多线程开销较大。

7.2.3 模型的改进

1.蚁群算法中的α和β的选取往往是通过经验来取得的，因而可以利用其他算法对蚁群系统参数α和β进行训练。
2.针对蚁群算法初始信息素匮乏的缺点，采用其他算法生成初始信息素分布，利用蚁群算法求精确解，从而提高时间效率和求解精度。亦可以在搜索过程中融入确定性局部搜索算法。
3.对于多线程，可以分别设置各个任务的优先级以优化性能。

7.3 问题五模型的评价

7.3.1 模型的优点

1.扰动函数增加随机性，使结果更具有统计意义和启发性。
2.建立的模型能与实际紧密联系，可操作性强，使模型更贴近实际，通用
性、推广性较强。

7.3.2 模型的缺点

1. 建模过程创新不足，约束条件可能不全面，知识面有待拓展。
2. 公式较复杂，计算较困难。
3. 时间段分得不够精细，比较粗糙。
4. 多线程与随机程度的再次增强，会使得程序运行的开销指数级增加，出现异常的几率更高，被抛出的数据无法为函数收敛起到帮助，即提高了函数收敛的难度。也意味着最后的结果可能是局部最优解而不是全局最优解。

7.3.3 模型的改进

1.对约束条件进行深入加强，对α、β进行训练。
2.对时间进行更细的划分。



	参考文献
[1] M. Dorigo, V. Maniezzo, et A. Colorni, Ant system: optimization by a colony of cooperating agents, IEEE Transactions on Systems, Man, and Cybernetics--Part B , volume 26, numéro 1, pages 29-41, 1996.
[2] 数据之巅，【C#代码实战】群蚁算法理论与实践全攻略——旅行商等路径优化问题的新方法，https://www.cnblogs.com/asxinyu/p/Path_Optimization_Tsp_Problem_Ant_System_CSharp.html，20150914。












	附件
9.1结果表格

表3 第一问结果表格
出发景点	到达景点	步行距离(米)
景石	森林小剧场	210
森林小剧场	儿童戏水场	265
儿童戏水场	游客服务中心	285
游客服务中心	阳光草坪	380
阳光草坪	儿童科普体验区	230
儿童科普体验区	湿地博物馆	260
湿地博物馆	湿地商业街	190
总步行距离(最短路线距离)	1820
最短路线(请用①~⑥序号标出)	景石→③→⑤→①→②→④→⑥→⑦
备注：可以根据需求增减本表格的行数



表4 第二问结果表格(游览时间最长的路线信息)
序号	景点名称	达到时间点	游览时间
(停留时间,单位分钟)	离开时间点
1	景石	12:00	0	12:00
2	阳光草坪	12:10	53	13:03
3	儿童科普体验区	13:09	36	13:45
4	森林小剧场	14:00	30	14:30
5	儿童戏水场	14:38	46	15:24
6	游客服务中心	15:33	23	15:56
7	湿地博物馆	16:02	42	16:44
8	湿地商业街	16:50	40	17:30
总的游览时间： 270分钟
总的步行时间： 60分钟

```
